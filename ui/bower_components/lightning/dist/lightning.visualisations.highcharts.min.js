/*! lightning 2017-10-05 */
!function(){"use strict";function a(){var a={restrict:"E",transclude:!0,require:["?^^chartDisplay","?^^chartGauge"],link:{pre:function(a,b,c,d){var e=d[0],f=d[1],g={enabled:!0,text:c.text,href:c.href};null!=e?e.addCreditOptions(g):null!=f&&f.addCreditOptions(g)}}};return a}angular.module("lightning").directive("chartCredit",a)}(),function(){"use strict";function a(a,b,c,d,e){var f={restrict:"E",scope:{response:"@",results:"=?",options:"=?",ytitle:"@",xtitle:"@"},transclude:!0,controller:["$scope","$attrs","$filter","$timeout","$element","$window","$lightningLog",function(f,g,h,i,j,k,l){function m(){angular.element(k).off("resize",n)}function n(){null!=f.seriesCopy&&i(function(){var a=angular.element(j[0].querySelector("#field-name")).text(),b=angular.element(j[0].querySelector("#count")).text();angular.element(j[0].querySelector("#field-name")).remove(),angular.element(j[0].querySelector("#count")).remove();var c=f.seriesCopy,d=c.chart.renderer,e=c.chart.plotLeft+c.center[0],g=c.chart.plotTop+c.center[1];d.text(a,e,g).attr({"text-anchor":"middle","font-size":"28px","font-weight":"800",id:"field-name"}).add(),d.text(b,e,g+30).attr({"text-anchor":"middle","font-size":"26px",id:"count"}).add(),a.length>=56?angular.element(j[0].querySelector("#field-name")).attr("font-size","6px"):a.length>=35?angular.element(j[0].querySelector("#field-name")).attr("font-size","8px"):a.length>=30?angular.element(j[0].querySelector("#field-name")).attr("font-size","10px"):a.length>=25?angular.element(j[0].querySelector("#field-name")).attr("font-size","12px"):a.length>=20?angular.element(j[0].querySelector("#field-name")).attr("font-size","14px"):a.length>=16?angular.element(j[0].querySelector("#field-name")).attr("font-size","18px"):a.length>=12?angular.element(j[0].querySelector("#field-name")).attr("font-size","20px"):angular.element(j[0].querySelector("#field-name")).attr("font-size","26px")},0)}function o(){f.allSeries=[],f.chartConfig.series=[],f.timeSeriesFacets=[],"time"!=g.type&&(f.chartConfig.xAxis.categories=[]),f.actCategories=[],f.singleFilterOverlay=!1,K=[],f.loading=0,f.query=d.getQueryAsHttpParams(g.query,!0)}function p(a){f.chartConfig&&f.chartConfig.series&&(g.hasOwnProperty("select")&&"checkbox"==g.select?(a.tkid=a.name+"-"+a.title+"-"+a.type,f.allSeries.push(a),f.unselectedSeries.indexOf(a.tkid)!=-1||a.hasOwnProperty("selected")&&1!=a.selected||f.chartConfig.series.push(a)):f.chartConfig.series.push(a)),angular.merge(f.chartConfig.options,f.options)}function q(a,b){0==f.chartConfig.series.length&&f.chartConfig.options.foo++;var c=null;"false"!=b.showMarker&&"true"!=b.showMarker||(c={enabled:"true"==b.showMarker});var e=s(b.name,b.type,b.tooltipOptions,c);e.title=b.title||b.name,e.selected=b.selected;var i=a.header.indexOf(b.labelField),j=a.header.indexOf(b.valueField),k=a.header.indexOf(b.urlField);if(angular.forEach(a.series,function(a){if(!isNaN(a[j])){var c=parseFloat(a[j]),d=a[i],g=null!=d.act?d.act:null!=d.dsp?d.dsp:d,l=null!=d.dsp?d.dsp:d,m=null;if(k!=-1&&(m=a[k]),null!=b.dateFormat&&("undefined"!=typeof l.indexOf?0==l.indexOf("<")?(l=l.substring(1),l=h("dateFormat")(l.trim(),b.dateFormat),l="&lt; "+l):0==l.indexOf(">")?(l=l.substring(1),l=h("dateFormat")(l.trim(),b.dateFormat),l="&gt; "+l):l=h("dateFormat")(l,b.dateFormat):l=h("dateFormat")(l,b.dateFormat)),H(f.actCategories,g)!=-1)e.data[H(f.actCategories,g)]=[l,c],null!=m?e.urls[H(f.actCategories,g)]=m:null!=b.query&&(e.filters[H(f.actCategories,g)]=[b.name,g,l,b.action]);else{f.chartConfig.xAxis.categories.push(l),f.actCategories.push(g),e.data.push([l,c]);var n;null!=m?(n=e.data.length>0?e.data.length-1:0,e.urls[n]=m):null!=b.query&&(n=e.data.length>0?e.data.length-1:0,e.filters[n]=[b.name,g,l,b.action])}}}),f.showInterval=Math.ceil(f.chartConfig.xAxis.categories.length/g.maxLabels),f.labelCounter=0,f.i=0,p(e),G(),null!=b.query&&g.hasOwnProperty("singleFilterMode")){var l=d.convertHttpParamsToQuery(b.query);if(l.filters)for(var m=0;m<l.filters.length;m++)b.name==l.filters[m].field&&1==e.data.length&&B(b.name,e.data[0][0],e.data[0][1])}}function r(b,c){0==f.chartConfig.series.length&&f.chartConfig.options.foo++,f.timeSeriesFacets.indexOf(c.name)==-1&&f.timeSeriesFacets.push(c.name),0!=f.chartConfig.options.rangeSelector.enabled&&null!=c.rangeSelector&&(f.chartConfig.options.rangeSelector.enabled=c.rangeSelector),0!=f.chartConfig.options.navigator.enabled&&null!=c.navigator&&(f.chartConfig.options.navigator.enabled=c.navigator),null!=c.query&&(f.chartConfig.options.xAxis={events:{afterSetExtremes:function(b){"zoom"==b.trigger&&(angular.forEach(f.timeSeriesFacets,function(b){a.removeFiltersFromUrl(b,!1)}),angular.forEach(f.timeSeriesFacets,function(c,d){var e=new Date(b.min).toISOString(),g=new Date(b.max).toISOString(),h=e.substring(0,e.length-5),i=g.substring(0,g.length-5);a.addRangeFilterToUrl(c,h,i,e,g,d==f.timeSeriesFacets.length-1,!1,"-")}))}}}),c.title=null==c.title?c.name:c.title;var d={name:c.title,data:[],tooltip:c.tooltipOptions,type:c.type,showInNavigator:!0,selected:c.selected};void 0!=c.markerOptions&&null!=c.markerOptions&&(d.marker=c.markerOptions);var e=[],g=b.header.indexOf(c.labelField),i=b.header.indexOf(c.valueField);angular.forEach(b.series,function(a){if(!isNaN(a[i])){var b;b=null!=a[g].act?null!=a[g].act.from?a[g].act.from:null!=a[g].act.to?a[g].act.to:a[g].act:a[g],e.push({act:new Date(b).valueOf(),count:a[i]})}}),"true"!=c.sort&&null!=c.sort||(e=h("orderBy")(e,"act")),angular.forEach(e,function(a){d.data.push([new Date(a.act).valueOf(),a.count])}),p(d),G(),f.$broadcast("highchartsng.reflow")}function s(c,d,e,i){d=null==d?g.type:d,"donut"==d&&(d="pie",null==f.chartConfig.options.plotOptions.pie.innerSize&&(f.chartConfig.options.plotOptions.pie.innerSize="50%"));var k={className:"highcharts-series-"+h("formatAsCssName")(c),name:c,data:[],type:d,urls:[],filters:[],events:{click:function(c){var d=c.point.index;if(null!=this.userOptions.urls[d])document.location=this.userOptions.urls[d];else if(null!=this.userOptions.filters[d]){var e=this.userOptions.filters[d];null!=e[3]&&b.path(e[3]);var f=e[1];null!=this.userOptions.query&&a.setUrlParameters(this.userOptions.query,!1),void 0!=f&&"range"==f.type?a.addRangeFilterDisplayToUrl(e[0],f.from,f.to,e[2],!0,!1,f.fromExcluded,f.toExcluded):a.addFilterToUrl(e[0],e[1],e[2],!0)}}},tooltip:e};return"pie"==d&&null!=g.innerSize&&"true"==g.showValue&&(k.point={events:{mouseOver:function(){f.seriesCopy=this.series,angular.element(j[0].querySelector("#field-name")).remove(),angular.element(j[0].querySelector("#count")).remove();var a=this.series,b=this.series.chart.renderer,c=this.series.chart.plotLeft+a.center[0],d=this.series.chart.plotTop+a.center[1];b.text(this.name,c,d).attr({"text-anchor":"middle","font-size":"28px","font-weight":"800",id:"field-name"}).add(),b.text(h("numberFormat")(this.y,"formatted"),c,d+30).attr({"text-anchor":"middle","font-size":"26px",id:"count"}).add(),angular.forEach(this.series.points,function(a){a.slice(!1)}),this.slice(!0),this.name.length>=56?angular.element(j[0].querySelector("#field-name")).attr("font-size","6px"):this.name.length>=35?angular.element(j[0].querySelector("#field-name")).attr("font-size","8px"):this.name.length>=30?angular.element(j[0].querySelector("#field-name")).attr("font-size","10px"):this.name.length>=25?angular.element(j[0].querySelector("#field-name")).attr("font-size","12px"):this.name.length>=20?angular.element(j[0].querySelector("#field-name")).attr("font-size","14px"):this.name.length>=16?angular.element(j[0].querySelector("#field-name")).attr("font-size","18px"):this.name.length>=12?angular.element(j[0].querySelector("#field-name")).attr("font-size","20px"):angular.element(j[0].querySelector("#field-name")).attr("font-size","26px")}}}),void 0!=i&&null!=i&&(k.marker=i),0==f.chartConfig.series.length&&void 0==f.chartConfig.options.legend?f.chartConfig.options.legend={enabled:!1}:void 0==f.chartConfig.options.legend&&(f.chartConfig.options.legend={enabled:!0}),null!=g.stacking&&(k.stacking=g.stacking),"pie"!=d&&(k.dataLabels={enabled:"true"==g.showDataLabels}),"bar"==d&&(f.chartConfig.options.chart.inverted=!0),t(d),k.data=Array.apply(null,new Array(f.chartConfig.xAxis.categories.length)).map(function(){return[null,null]}),k}function t(a){"true"==g.threeD&&("pie"==a?(f.chartConfig.options.chart.options3d={enabled:!0,alpha:45,beta:0,depth:40},f.chartConfig.options.chart.marginTop=0):(f.chartConfig.options.chart.options3d={enabled:!0,alpha:15,beta:15,viewDistance:25,depth:40},f.chartConfig.options.chart.marginTop=40,f.chartConfig.options.chart.spacingRight=60))}function u(a,b,c,d,e,j,k,l,m,n){if(null!=a){0==f.chartConfig.series.length&&(F(),f.chartConfig.options.foo++,i(function(){G()},500)),C(a),c=null==c?a.display:c;var o=a.field,q=s(c,b,j,m);q.title=q.title||c,q.selected=n!==!1,q.query=d,angular.forEach(a.filters,function(a){if(!isNaN(a.count)){var b=h("actualValue")(a.val),c=h("displayValue")(a.val);if(null!=k&&("undefined"!=typeof c.indexOf?0==c.indexOf("<")?(c=c.substring(1),c=h("dateFormat")(c.trim(),k),c="&lt; "+c):0==c.indexOf(">")?(c=c.substring(1),c=h("dateFormat")(c.trim(),k),c="&gt; "+c):c=h("dateFormat")(c,k):c=h("dateFormat")(c,k)),H(f.actCategories,b)!=-1)q.data[H(f.actCategories,b)]=[c,null==l||"count"==l?a.count:a.facts[l][0]],null!=d&&(q.filters[H(f.actCategories,b)]=[o,b,c,e]);else if(f.chartConfig.xAxis.categories.push(c),f.actCategories.push(b),q.data.push([c,null==l||"count"==l?a.count:a.facts[l][0]]),null!=d){var g=q.data.length>0?q.data.length-1:0;q.filters[g]=[o,b,c,e]}}}),f.showInterval=Math.ceil(f.chartConfig.xAxis.categories.length/g.maxLabels),f.labelCounter=0,f.i=0,p(q)}}function v(b,c,d,e,g,j,k,l,m,n,o,q){if(null!=b){0==f.chartConfig.series.length&&(F(),f.chartConfig.options.foo++,i(function(){G()},500)),f.timeSeriesFacets.indexOf(c)==-1&&f.timeSeriesFacets.push(c),0!=f.chartConfig.options.rangeSelector.enabled&&null!=j&&(f.chartConfig.options.rangeSelector.enabled=j),0!=f.chartConfig.options.navigator.enabled&&null!=k&&(f.chartConfig.options.navigator.enabled=k),null!=l&&(f.chartConfig.options.xAxis={events:{afterSetExtremes:function(b){"zoom"==b.trigger&&(angular.forEach(f.timeSeriesFacets,function(b){a.removeFiltersFromUrl(b,!1)}),angular.forEach(f.timeSeriesFacets,function(c,d){var e=new Date(b.min).toISOString(),g=new Date(b.max).toISOString(),h=e.substring(0,e.length-5),i=g.substring(0,g.length-5);a.addRangeFilterToUrl(c,h,i,e,g,d==f.timeSeriesFacets.length-1,!1,"-")}))}}}),d=null==d?b.display:d;var r={name:d,data:[],tooltip:g,type:e,showInNavigator:!0};r.selected=q!==!1,void 0!=n&&null!=n&&(r.marker=n);var s=[];angular.forEach(b.filters,function(a){if(!isNaN(a.count)){var b=h("actualValue")(a.val);void 0!=b&&"range"==b.type&&(b=b.from),s.push({act:b,count:null==m||"count"==m?a.count:a.facts[m][0]})}}),"true"!=o&&null!=o||(s=h("orderBy")(s,"act")),angular.forEach(s,function(a){r.data.push([new Date(a.act).valueOf(),a.count])}),p(r),f.$broadcast("highchartsng.reflow")}}function w(a,b,c,d,e,j,k,l,m,n,o){if(null!=a){0==f.chartConfig.series.length&&(F(),f.chartConfig.options.foo++,i(function(){G()},500)),e=null==e?c:e;var q=s(e,d,m,n);q.title=q.title||e,q.selected=o;for(var r=0;r<a.length;r++){var t=a[r];null!=t.result&&(t=t.result);var u=null!=t.fields[b]?h("displayValue")(t.fields[b]):"",v=null!=t.fields[c]?h("actualValue")(t.fields[c]):"",w=null!=j&&null!=t.fields[j]?h("actualValue")(t.fields[j].val):null;if(v=""==v||isNaN(v)?null:parseFloat(v),f.chartConfig.xAxis.categories.indexOf(u)!=-1)q.data[f.chartConfig.xAxis.categories.indexOf(u)]=[u,v],null!=w?q.urls[f.chartConfig.xAxis.categories.indexOf(u)]=w:null!=k&&(q.filters[f.chartConfig.xAxis.categories.indexOf(u)]=[c,v,v,l]);else{f.chartConfig.xAxis.categories.push(u),q.data.push([u,v]);var x;null!=w?(x=q.data.length>0?q.data.length-1:0,q.urls[x]=w):null!=k&&(x=q.data.length>0?q.data.length-1:0,q.filters[x]=[c,v,v,l])}}f.showInterval=Math.ceil(f.chartConfig.xAxis.categories.length/g.maxLabels),f.labelCounter=0,p(q)}}function x(a){f.chartConfig.options.exporting=a}function y(a){f.chartConfig.credits=a}function z(a){f.chartConfig.options.legend=a}function A(a){f.chartConfig.options.tooltip=a}function B(a,b,c){if(g.hasOwnProperty("singleFilterMode")){var d={name:a,value:b,count:c};K.push(d),1===K.length?(f.singleFilterOverlay=!0,f.overlayFacet=K[0].name,f.overlayValue=K[0].value,f.overlayCount=K[0].count):f.singleFilterOverlay=!1}}function C(a){if(a&&a.filters&&g.hasOwnProperty("singleFilterMode")&&f.response&&f.response.query&&f.response.query.filters)for(var b=0;b<f.response.query.filters.length;b++)if(a.field==f.response.query.filters[b].field)for(var c=0;c<a.filters.length;c++)h("actual")(f.response.query.filters[b].val)==h("actual")(a.filters[c].val)&&a.filters[c].count==a["sum-of-counts"]&&B(a.field,h("display")(a.filters[c].val),a.filters[c].count)}function D(a){if(null!=g.query){var b=d.getQueryAsHttpParams(g.query,a);if(null!=b)return b}}function E(){return g.response}function F(){f.loading<=0&&i(function(){f.chartConfig.loading='<div class="tk-stl-circle-loader"></div>'},0),f.loading++}function G(){f.loading--,f.loading<=0&&i(function(){f.chartConfig.loading=!1},0)}function H(a,b){if(angular.isObject(b)){var c=h("filter")(a,b,!0)[0];return a.indexOf(c)}return a.indexOf(b)}function I(){return g}function J(){return f.results||null}var K=[];f.timeSeriesFacets=[],f.actCategories=[],f.loading=0,f.allSeries=[],f.unselectedSeries=[],null!=g.backgroundColor&&l.warn("ChartDisplay","background-color attribute has been deprecated, please change the background colour using css. Eg #id-of-container .highcharts-background{ fill:pink}. For more info see - http://www.highcharts.com/docs/chart-design-and-style/style-by-css"),null!=g.color&&l.warn("ChartDisplay","color attribute has been deprecated, please change the series colour using css. Eg #id-of-container .highcharts-color-0{ fill:pink; stoke:pink;}. For more info see - http://www.highcharts.com/docs/chart-design-and-style/style-by-css"),f.$watch(function(){return j[0].offsetTop>0&&j[0].offsetLeft>0},function(){j[0].offsetTop>0&&j[0].offsetLeft>0&&f.$broadcast("highchartsng.reflow")}),null!=g.innerSize&&"true"==g.showValue&&(angular.element(k).on("resize",n),f.$on("$destroy",m));var L=this;L.addFacetSeries=u,L.addTimeSeries=v,L.addResultListSeries=w,L.addExportingOptions=x,L.addCreditOptions=y,L.addLegendOptions=z,L.addTooltipOptions=A,L.addSeries=q,L.addPlatformTimeSeries=r,L.getQuery=D,L.getResponse=E,L.setLoading=F,L.unsetLoading=G,L.getChartAttributes=I,L.getResultsAttribute=J,f.type=null==g.type?"pie":g.type,g.maxCharacters=null==g.maxCharacters?"250":g.maxCharacters,g.height=null==g.height?"400":g.height,f.removeFilterFromUrl=function(b){a.removeFiltersFromUrl(b,!0)},f.toggleSeries=function(a){if(f.chartConfig&&f.chartConfig.series){for(var b,c=!1,d=0;d<f.chartConfig.series.length;d++)a.id==f.chartConfig.series[d].id&&(c=!0,b=d);c?(f.chartConfig.series.splice(b,1),f.unselectedSeries.push(a.tkid)):(f.chartConfig.series.push(a),f.unselectedSeries.splice(f.unselectedSeries.indexOf(a.tkId),1)),f.$broadcast("highchartsng.reflow")}},f.seriesIsSelected=function(a){for(var b=!1,c=0;c<f.chartConfig.series.length;c++)a.id==f.chartConfig.series[c].id&&(b=!0);return b},void 0==f.chartConfig&&(f.chartConfig={options:{foo:1,chart:{},exporting:{enabled:!1},plotOptions:{pie:{dataLabels:{enabled:"false"!=g.showLabels,formatter:function(){f.labelCounter++;var a=parseInt(g.maxCharacters),b=0,c=f.chartConfig.xAxis.categories.indexOf(this.key);if(c!=-1){for(f.i=0;f.i<f.chartConfig.series.length;f.i++)c<f.chartConfig.series[f.i].data.length&&(b+=f.chartConfig.series[f.i].data[c][1]);if(g.maxLabels!=-1||f.labelCounter%f.showInterval==0)return a>0&&this.key.length>a?this.key.substr(0,a)+"..."+("true"==g.showCount?" ("+b+")":""):this.key+("true"==g.showCount?" ("+b+")":"")}}}}},rangeSelector:{enabled:!1},navigator:{enabled:!1}},useHighStocks:!1,size:{height:g.height},series:[],xAxis:{title:{text:f.xtitle}},credits:{enabled:!1},yAxis:{title:{text:f.ytitle}},title:{text:g.title},subtitle:{text:g.subtitle},loading:!1,func:function(a){if(i(function(){if(null!=a&&null!=a.hasRendered){if(null!=g.innerSize&&"true"==g.showValue){f.seriesCopy=a.series[0];var b=a.series[0];if(null!=b){var c=a.renderer,d=a.plotLeft+b.center[0],e=a.plotTop+b.center[1],i=null;angular.forEach(b.points,function(a){null==i?i=a:i.y<a.y&&(i=a)});var j="";j=i.name.length>=56?"6px":i.name.length>=35?"8px":i.name.length>=30?"10px":i.name.length>=25?"12px":i.name.length>=20?"14px":i.name.length>=16?"18px":i.name.length>=12?"20px":"26px",i.slice(!0),c.text(i.name,d,e).attr({"text-anchor":"middle","font-size":j,"font-weight":"800",id:"field-name"}).add(),c.text(h("numberFormat")(i.y,"formatted"),d,e+30).attr({"text-anchor":"middle","font-size":"26px",id:"count"}).add()}}a.reflow()}},0),g.websocket){var b=c(g.websocket);b.onMessage(function(b){var c=JSON.parse(b.data);a.series[0].addPoint({y:c.count,name:c.val.dsp})})}}},"time"==g.type?(f.chartConfig.options.chart.zoomType="x",f.chartConfig.options.rangeSelector.enabled=!0,f.chartConfig.options.navigator.enabled=!0,f.chartConfig.useHighStocks=!0,f.chartConfig.xAxis.labels={rotation:parseInt(g.xlabelRotation)||0,enabled:"false"!=g.showLabels}):f.chartConfig.xAxis.categories=[],"radar"==g.radarOrPolar?(f.chartConfig.options.chart.polar=!0,f.chartConfig.yAxis.gridLineInterpolation="polygon",f.chartConfig.yAxis.lineWidth=0,f.chartConfig.xAxis.lineWidth=0,f.chartConfig.xAxis.tickmarkPlacement="on",j.addClass("radar-chart")):"polar"==g.radarOrPolar?(f.chartConfig.options.chart.polar=!0,f.chartConfig.yAxis.gridLineInterpolation="circle",f.chartConfig.yAxis.lineWidth=1,f.chartConfig.xAxis.lineWidth=1,f.chartConfig.xAxis.tickmarkPlacement="on"):"time"!=g.type&&(f.chartConfig.xAxis.labels={rotation:parseInt(g.xlabelRotation)||0,enabled:"false"!=g.showLabels,formatter:function(){f.labelCounter++;var a=parseInt(g.maxCharacters),b=0,c=f.chartConfig.xAxis.categories.indexOf(this.value);if(c!=-1){for(f.i=0;f.i<f.chartConfig.series.length;f.i++)c<f.chartConfig.series[f.i].data.length&&(b+=f.chartConfig.series[f.i].data[c][1]);if(g.maxLabels!=-1||f.labelCounter%f.showInterval==0)return a>0&&this.value.length>a?this.value.substr(0,a)+"..."+("true"==g.showCount?" ("+b+")":""):this.value+("true"==g.showCount?" ("+b+")":"")}}}),null!=g.innerSize&&(f.chartConfig.options.plotOptions.pie.innerSize=g.innerSize),"false"==g.showTooltips&&(f.chartConfig.options.tooltip={enabled:!1}),"true"!=g.invertAxes&&"bar"!=g.type||(f.chartConfig.options.chart.inverted=!0),null!=f.options&&angular.extend(f.chartConfig.options,f.options)),null!=g.response?(f.response=e.getResponse(g.response),null!=f.response&&(o(),f.response.facets&&null!=f.response.facets[g.facetName]&&u(f.response.facets[g.facetName],f.type,g.facetName,f.query)),f.$on(g.response+"_updated",function(){o(),f.response=e.getResponse(g.response),f.response.facets&&null!=f.response.facets[g.facetName]&&L.addFacetSeries(f.response.facets[g.facetName],f.type,g.facetName,f.query)})):f.$on("reloadSearch",function(){o()})}],template:function(a,b){var c="";return b.hasOwnProperty("singleFilterMode")&&(c+='<div class="tk-stl-single-filter-mode-wrapper">'),b.hasOwnProperty("response")?(c+='<div class="tk-stl-chart-display" ng-if="response != null">',b.hasOwnProperty("select")&&"checkbox"==b.select&&(c+='<div class="tk-stl-series-select" ng-if="allSeries.length > 1"><a ng-click="showSeriesSelect = !showSeriesSelect">Series</a><div class="popover" ng-show="showSeriesSelect"><input type="text" ng-model="seriesSearch" placeholder="Search series"/><ul><li ng-click="toggleSeries(series)" ng-repeat="series in allSeries | filter:{name: seriesSearch}">{{ series.name }}<i class="icon-ok" ng-show="seriesIsSelected(series)"></i></li></ul></div></div>'),c+='<div ng-transclude></div><highchart config="chartConfig"></highchart></div>'):(c+='<div class="tk-stl-chart-display">',b.hasOwnProperty("select")&&"checkbox"==b.select&&(c+='<div class="tk-stl-series-select"><a ng-click="showSeriesSelect = !showSeriesSelect">Series</a><div class="popover" ng-show="showSeriesSelect"><input type="text" ng-model="seriesSearch" placeholder="Search series"/><ul><li ng-click="toggleSeries(series)" ng-repeat="series in allSeries | filter:{title: seriesSearch}">{{ series.title }}<i class="icon-ok" ng-show="seriesIsSelected(series)"></i></li></ul></div></div>'),c+='<div ng-transclude></div><highchart config="chartConfig"></highchart></div>'),b.hasOwnProperty("singleFilterMode")&&(c+='<div class="tk-stl-single-filter-overlay clickable" ng-if="singleFilterOverlay" ng-click="removeFilterFromUrl(overlayFacet)"><span class="removeFilter">&times;</span><h4>{{ overlayFacet }}</h4><h2>{{ overlayValue }}</h2><h3>{{ overlayCount }}</h3></div></div>'),c}};return f}angular.module("lightning").directive("chartDisplay",a),a.$inject=["$lightningUrl","$location","$websocket","QueryService","ResponseService"]}(),function(){"use strict";function a(){var a={restrict:"E",transclude:!0,require:["?^^chartDisplay","?^^chartGauge"],link:{pre:function(a,b,c,d){var e=d[0],f=d[1],g={enabled:!0,filename:c.fileName,url:null==c.url?"http://export.highcharts.com":c.url,chartOptions:{chart:{backgroundColor:"white"}}};null!=e?e.addExportingOptions(g):null!=f&&f.addExportingOptions(g)}}};return a}angular.module("lightning").directive("chartExport",a)}(),function(){"use strict";function a(a){var b={restrict:"E",transclude:!0,require:"^^chartDisplay",link:{pre:function(b,c,d,e){var f={enabled:!0,title:{text:d.title},x:parseInt(d.x)||0,y:parseInt(d.y)||0,margin:40};null!=d.borderRadius&&a.warn("ChartLegend","border-radius attribute has been deprecated, please set the border-radius using css. Eg #id-of-container .highcharts-legend-box { fill: none; stroke-width: 1px; stroke: black; rx:2;  }. For more info see - http://www.highcharts.com/docs/chart-design-and-style/style-by-css"),null!=d.borderWidth&&a.warn("ChartLegend","border-width attribute has been deprecated, please set the border-width using css. Eg #id-of-container .highcharts-legend-box { fill: none; stroke-width: 1px; stroke: black; rx:2;  }. For more info see - http://www.highcharts.com/docs/chart-design-and-style/style-by-css"),null!=d.align&&(f.align=d.align),null!=d.verticalAlign&&(f.verticalAlign=d.verticalAlign),null!=d.layout&&(f.layout=d.layout),e.addLegendOptions(f)}}};return b}angular.module("lightning").directive("chartLegend",a),a.$inject=["$lightningLog"]}(),function(){"use strict";function a(){var a={restrict:"E",transclude:!0,require:["?^^chartDisplay","?^^seriesFacet","?^^seriesResultList"],link:{pre:function(a,b,c,d){var e=d[0],f=d[1],g=d[2],h={shared:"true"===c.shared};null!=c.headerFormat&&(h.headerFormat=c.headerFormat),null!=c.pointFormat&&(h.pointFormat=c.pointFormat),null!=g?g.addTooltipOptions(h):null!=f?f.addTooltipOptions(h):e.addTooltipOptions(h)}}};return a}angular.module("lightning").directive("chartTooltip",a)}(),function(){"use strict";function a(a,b,c,d,e){var f={restrict:"E",transclude:!0,scope:{},link:function(f,g,h){function i(){var a=j.facets[h.facetName],g=null==h.key?"hc-key":h.key,i=null==h.title?"":h.title,k=null==h.subtitle?"":h.subtitle;if(null==a)return void(f.show=!1);f.show=!0;var l=h.seriesName||a.display||h.facetName;if(null==Highcharts.maps[h.map])return c.error("Chart:Highmaps","Map named - "+h.map+' - could not be found, please make sure the script tag for the map is included. eg <script src="//code.highcharts.com/mapdata/countries/gb/gb-all.js"></script>. Maps can be found at - http://code.highcharts.com/mapdata/'),void(f.show=!1);var m=[];angular.forEach(a.filters,function(a){var c={value:a.count};c[g]=b("actual")(a.val),m.push(c)}),f.config={options:{plotOptions:{map:{mapData:Highcharts.maps[h.map],joinBy:[g]}},mapNavigation:{enabled:!0,buttonOptions:{verticalAlign:"bottom"}},colorAxis:{min:0}},chartType:"map",title:{text:i},subtitle:{text:k},series:[{data:m,mapData:Highcharts.maps[h.map],joinBy:[g],states:{hover:{color:"black"}},events:{click:function(b){if(null!=h.query){var c=d.getQueryAsHttpParams(h.query,!0);null!=c&&e.setUrlParameters(c,!1),e.addFilterToUrl(a.field,b.point.name,b.point.name,!0)}}},name:l,showInLegend:!0},{name:"Separators",type:"mapline",data:Highcharts.geojson(Highcharts.maps[h.map],"mapline"),color:"silver",showInLegend:!1,enableMouseTracking:!1}]}}var j=a.getResponse(h.response,"facets");null!=j?i():f.show=!1,f.$on(h.response+"_updated",function(){j=a.getResponse(h.response,"facets"),i()})},template:function(){var a="<div>";return a+='<highchart config="config" ng-if="show" style="height:700px;"></highchart>',a+="</div>"}};return f}angular.module("lightning").directive("geoHighmaps",a),a.$inject=["ResponseService","$filter","$lightningLog","QueryService","$lightningUrl"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h={restrict:"E",scope:{measure:"@"},transclude:!0,require:"^^chartDisplay",controller:["$scope",function(a){function b(b){a.tooltipOptions=b}var c=this;a.tooltipOptions=null,c.addTooltipOptions=b}],link:{post:function(h,i,j,k){function l(a){return null!=j.query?e.getQueryAsHttpParams(j.query,a):k.getQuery(a)}function m(){h.measure=null==h.measure?"count":h.measure,h.query=l(!0),k.setLoading();var a=parseInt(j.numberToShow)?parseInt(j.numberToShow):10,b=l(!1);c.searchSeriesFacet(b,o,j.name,h.measure,a).then(function(a){var b={name:j.name,labelField:"value",valueField:h.measure,type:j.type,title:j.title,action:j.action,dateFormat:j.dateFormat,measure:h.measure,query:h.query,showMarker:j.showMarker,tooltipOptions:h.tooltipOptions,selected:"false"!=j.selectedByDefault};k.addSeries(a.data,b)},function(a){f.error("Series:Facet","Error retrieving series from platform - "+a.status+" - "+a.statusText),k.unsetLoading()})}function n(b){var c=angular.copy(b.facets[j.name]);h.query=l(!0),parseInt(j.numberToShow)&&null!=c&&(c.filters=a("limitTo")(c.filters,j.numberToShow));var d=null;"false"!=j.showMarker&&"true"!=j.showMarker||(d={enabled:"true"==j.showMarker});var e="false"!=j.selectedByDefault;k.addFacetSeries(c,j.type,j.title,h.query,j.action,h.tooltipOptions,j.dateFormat,h.measure,d,e)}h.addFacetSeries=n,null!=j.color&&f.warn("SeriesFacet","color attribute has been deprecated, please change the series colour using css. Eg #id-of-container .highcharts-color-0{ fill:pink; stoke:pink;}. For more info see - http://www.highcharts.com/docs/chart-design-and-style/style-by-css");var o,p;if(null!=j.platform)o=b.getPlatform(j.platform),m(),h.$on("reloadSearch",function(){d(function(){m()},0)});else if(null==j.response){var q=k.getResponse();p=g.getResponse(q,"facets"),null!=p&&h.addFacetSeries(p),h.$on(q+"_updated",function(a,b){null!=b&&d(function(){h.addFacetSeries(b)},0)})}else p=g.getResponse(j.response,"facets"),null!=p&&h.addFacetSeries(p),h.$on(j.response+"_updated",function(a,b){null!=b&&d(function(){h.addFacetSeries(b)},0)})}},template:"<div ng-transclude></div>"};return h}angular.module("lightning").directive("seriesFacet",a),a.$inject=["$filter","PlatformService","$twigkit","$timeout","QueryService","$lightningLog","ResponseService"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h={restrict:"E",scope:{results:"=?",valueField:"@",labelField:"@",title:"@"},transclude:!0,require:"^^chartDisplay",controller:["$scope",function(a){function b(b){a.tooltipOptions=b}var c=this;a.tooltipOptions=null,c.addTooltipOptions=b}],link:{post:function(h,i,j,k){function l(a){return null!=j.query?e.getQueryAsHttpParams(j.query,a):k.getQuery(a)}function m(){h.query=l(!0),k.setLoading();var a=[];a.push(h.labelField),a.push(h.valueField),null!=j.urlField&&a.push(j.urlField);var c=parseInt(j.numberToShow)?parseInt(j.numberToShow):10,e=l(!1);b.searchSeriesFields(e,n,a.join(","),c).then(function(a){var b={name:h.valueField,labelField:h.labelField,valueField:h.valueField,type:j.type,title:h.title,action:j.action,urlField:j.urlField,query:h.query,showMarker:j.showMarker,tooltipOptions:h.tooltipOptions,selected:"false"!=j.selectedByDefault};d(function(){k.addSeries(a.data,b)},0)},function(a){f.error("Series:ResultList","Error retrieving series from platform - "+a.status+" - "+a.statusText),k.unsetLoading()})}null!=j.color&&f.warn("SeriesResultList","color attribute has been deprecated, please change the series colour using css. Eg #id-of-container .highcharts-color-0{ fill:pink; stoke:pink;}. For more info see - http://www.highcharts.com/docs/chart-design-and-style/style-by-css"),h.addResultListSeries=function(b){var c=angular.copy(b.results);h.query=l(!0),parseInt(j.numberToShow)&&(c=a("limitTo")(c,j.numberToShow));var d=null;"false"!=j.showMarker&&"true"!=j.showMarker||(d={enabled:"true"==j.showMarker});var e="false"!=j.selectedByDefault;k.addResultListSeries(c,h.labelField,h.valueField,j.type,h.title,j.urlField,h.query,j.action,h.tooltipOptions,d,e)};var n,o,p=k.getChartAttributes();if(null!=j.platform)n=c.getPlatform(j.platform),d(function(){m()},0),h.$on("reloadSearch",function(){d(function(){m()},0)});else if(null==j.response&&null!=j.results)h.$watch("results",function(a){a&&h.addResultListSeries({results:a})});else if(null==j.response&&null!=p.results)h.$watch(k.getResultsAttribute,function(a){a&&h.addResultListSeries({results:a})});else if(null==j.response){var q=k.getResponse();o=g.getResponse(q),null!=o&&h.addResultListSeries(o),h.$on(q+"_updated",function(a,b){null!=b&&d(function(){h.addResultListSeries(b)},0)})}else o=g.getResponse(j.response),null!=o&&h.addResultListSeries(o),h.$on(j.response+"_updated",function(a,b){null!=b&&d(function(){h.addResultListSeries(b)},0)})}},template:"<div ng-transclude></div>"};return h}angular.module("lightning").directive("seriesResultList",a),a.$inject=["$filter","$twigkit","PlatformService","$timeout","QueryService","$lightningLog","ResponseService"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h={restrict:"E",scope:{measure:"@",valueField:"@",labelField:"@",title:"@"},transclude:!0,require:"^^chartDisplay",controller:["$scope",function(a){function b(b){a.tooltipOptions=b}var c=this;a.tooltipOptions=null,c.addTooltipOptions=b}],link:{post:function(h,i,j,k){function l(a){return null!=j.query?d.getQueryAsHttpParams(j.query,a):k.getQuery(a)}function m(){return{name:j.name,labelField:null!=h.labelField?h.labelField:"value",valueField:null!=h.valueField?h.valueField:h.measure,type:h.type,title:j.title,query:null!=j.query||null!=h.query?h.query:null,showMarker:j.showMarker,tooltipOptions:h.tooltipOptions,rangeSelector:"false"!=j.rangeSelector,navigator:"false"!=j.navigator,sort:j.sort,selected:"false"!=j.selectedByDefault}}function n(){h.measure=null==h.measure?"count":h.measure,h.query=l(!0),k.setLoading();var a=parseInt(j.numberToShow)?parseInt(j.numberToShow):25,b=l(!1);if(null!=h.labelField&&null!=h.valueField){var d=[];d.push(h.labelField),d.push(h.valueField),null!=j.urlField&&d.push(j.urlField),c.searchSeriesFields(b,p,d.join(","),a).then(function(a){var b=m();k.addPlatformTimeSeries(a.data,b)},function(a){e.error("Series:Time","Error retrieving series from platform - "+a.status+" - "+a.statusText),k.unsetLoading()})}else c.searchSeriesFacet(b,p,j.name,h.measure,a).then(function(a){var b=m();k.addPlatformTimeSeries(a.data,b)},function(a){e.error("Series:Time","Error retrieving series from platform - "+a.status+" - "+a.statusText),k.unsetLoading()})}function o(a){if(h.query=l(!0),null!=j.name){var b=angular.copy(a.facets[j.name]),c="false"!=j.rangeSelector,d="false"!=j.navigator,e="false"!=j.selectedByDefault,g=null;"false"!=j.showMarker&&"true"!=j.showMarker||(g={enabled:"true"==j.showMarker}),k.addTimeSeries(b,j.name,j.title,h.type,h.tooltipOptions,c,d,h.query,h.measure,g,j.sort,e)}else if(null!=h.valueField&&null!=h.labelField){var i=m();i.name=h.labelField;for(var n={header:[h.labelField,h.valueField],series:[]},o=0;o<a.results.length;o++){var p=f("result")(a,o);if(null!=p.fields[h.labelField]&&null!=p.fields[h.valueField]){var q=[];q.push({act:f("actual")(p.fields[h.labelField]),
dsp:f("display")(p.fields[h.labelField])}),q.push(f("actual")(p.fields[h.valueField])),n.series.push(q)}}k.addPlatformTimeSeries(n,i)}}null!=j.color&&e.warn("SeriesTime","color attribute has been deprecated, please change the series colour using css. Eg #id-of-container .highcharts-color-0{ fill:pink; stoke:pink;}. For more info see - http://www.highcharts.com/docs/chart-design-and-style/style-by-css"),h.type=null==j.type?"spline":j.type;var p,q;if(null!=j.platform)p=a.getPlatform(j.platform),n(),h.$on("reloadSearch",function(){b(function(){n()},0)});else if(null==j.response){var r=k.getResponse();q=g.getResponse(r),null!=q&&o(q),h.$on(r+"_updated",function(a,c){null!=c&&b(function(){o(c)},0)})}else q=g.getResponse(j.response),null!=q&&o(q),h.$on(j.response+"_updated",function(a,c){null!=c&&b(function(){o(c)},0)})}},template:"<div ng-transclude></div>"};return h}angular.module("lightning").directive("seriesTime",a),a.$inject=["PlatformService","$timeout","$twigkit","QueryService","$lightningLog","$filter","ResponseService"]}();